/**
 * Angular provider for integration with WebAPI2 token authentication
 * @version v0.0.6 - 2014-04-16
 * @link 
 * @author Kenneth Lynne <kenneth.lynne@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */angular.module("kennethlynne.webAPI2Authentication",[]).provider("webAPIAuth",["$httpProvider",function(a){var b="",c="",d="token";a.interceptors.push(["$q","$injector",function(a,b){return{request:function(d){var e=b.get("webAPIAuth").getToken(),f=d.url.substr(0,c.length)===c;return e&&f&&(d.headers.Authorization="Bearer "+e),d||a.when(d)}}}]),this.setLocalstorageKey=function(a){d=a},this.setTokenEndpointUrl=function(a){b=a},this.setAPIUrl=function(a){c=a},this.$get=["$http","$window","$log","$q",function(a,c,e,f){var g=c.localStorage,h=function(){g.removeItem(d)},i=function(){return g.getItem(d)},j=function(a){return g.setItem(d,a)},k=function(c,d,g){var h=f.defer(),i={method:"POST",url:b,data:"grant_type="+c+"&username="+d+"&password="+g,headers:{"Content-Type":"application/x-www-form-urlencoded"}};return a(i).then(function(a){if(a&&a.data){var b=a.data;j(b.access_token),h.resolve(!0)}else h.reject("No data received")}).catch(function(a){var b=a&&a.data&&a.data.message?a.data.message:"";h.reject("Could not log you in. "+b)}).finally(function(){e.log("Log in request finished.")}),h.promise},l=function(){return"string"==typeof i()};return{isLoggedIn:l,login:k,getToken:i,setToken:j,logout:h}}]}]);