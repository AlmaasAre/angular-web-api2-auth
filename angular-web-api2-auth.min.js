/**
 * Angular provider for integration with WebAPI2 token authentication
 * @version v0.0.5 - 2014-04-09
 * @link 
 * @author Kenneth Lynne <kenneth.lynne@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */angular.module("kennethlynne.webAPI2Authentication",[]).provider("webAPIAuth",["$httpProvider",function(a){var b="",c="";a.interceptors.push(["$q","$injector",function(a,b){return{request:function(d){var e=b.get("webAPIAuth").getToken(),f=d.url.substr(0,c.length)===c;return e&&f&&(d.headers.Authorization="Bearer "+e),d||a.when(d)}}}]),this.setTokenEndpointUrl=function(a){b=a},this.setAPIUrl=function(a){c=a},this.$get=["$http","$window","$log","$q",function(a,c,d,e){var f=c.localStorage,g=function(){f.removeItem("token")},h=function(){return f.getItem("token")},i=function(c,g,h){var i=e.defer(),j={method:"POST",url:b,data:"grant_type="+c+"&username="+g+"&password="+h,headers:{"Content-Type":"application/x-www-form-urlencoded"}};return a(j).then(function(a){if(a&&a.data){var b=a.data;f.setItem("token",b.access_token),i.resolve(!0)}else i.reject("No data received")}).catch(function(a){var b=a&&a.data&&a.data.message?a.data.message:"";i.reject("Could not log you in. "+b)}).finally(function(){d.log("Log in request finished.")}),i.promise},j=function(){return"string"==typeof h()};return{isLoggedIn:j,login:i,getToken:h,logout:g}}]}]);